"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[12],{3921:function(Qe,ee,r){r.r(ee),r.d(ee,{default:function(){return Te}});var oe=r(13448),M=r.n(oe),ue=r(74815),te=r.n(ue),le=r(77117),H=r.n(le),ie=r(28152),g=r.n(ie),h=r(93236),ce=r(69931),X=r(98984),u=r(67801),ne=r(30301),Y=r(93034),de=r(36222),re=r(53970),he=r(95020),I=r(31756),z=r(53330),ve=r(56425),fe=r(23817),pe=r(30189),me=r(51593),xe=r(52461),e=r(62086),ye=I.Z.Search,ge=function x(n){return n==null?void 0:n.map(function(t){var i={key:t.hostGroupId,title:t.name};return t.children&&t.children.length>0&&(i.children=x(t.children)),i})},ae=[],je=function x(n){for(var t=0;t<(n==null?void 0:n.length);t++){var i=n[t],v=i.title;ae.push({key:i.key,title:v}),i.children&&x(i.children)}},Se=function x(n,t){for(var i,v=0;v<t.length;v++){var y=t[v];y.children&&(y.children.some(function(N){return N.key===n})?i=y.key:x(n,y.children)&&(i=x(n,y.children)))}return i},Ce=function(n){var t=n.data,i=n.onGroupSelect,v=(0,h.useState)([]),y=g()(v,2),N=y[0],L=y[1],U=(0,h.useState)(""),k=g()(U,2),j=k[0],E=k[1],$=(0,h.useState)(!0),P=g()($,2),F=P[0],D=P[1],G=(0,h.useMemo)(function(){return ge(t)},[t]);(0,h.useEffect)(function(){je(G)},[G]);var l=function(p){L(p),D(!1)},f=function(p){var S=p.target.value,B=ae.map(function(m){return m.title.indexOf(S)>-1?Se(m.key,G):null}).filter(function(m,C,O){return!!(m&&O.indexOf(m)===C)});L(B),E(S),D(!0)},c=(0,h.useMemo)(function(){var A=function p(S){return S==null?void 0:S.map(function(B){var m=B.title,C=m.indexOf(j),O=m.substring(0,C),_=m.slice(C+j.length),W=C>-1?(0,e.jsxs)("span",{children:[O,(0,e.jsx)("span",{className:"site-tree-search-value",children:j}),_]}):(0,e.jsx)("span",{children:m});return B.children?{title:W,key:B.key,children:p(B.children)}:{title:W,key:B.key}})};return A(G)},[j,G]),K=function(p,S){p.length>0&&(console.log("selected",p[0]),i(p[0]))};return(0,e.jsxs)(Y.Z,{size:"middle",direction:"vertical",style:{width:"100%"},children:[(0,e.jsx)(ye,{style:{marginBottom:8},placeholder:"\u641C\u7D22\u6307\u5B9A\u673A\u7EC4",onChange:f}),(0,e.jsx)(xe.Z,{showLine:!0,onExpand:l,expandedKeys:N,autoExpandParent:F,treeData:c,onSelect:K})]})},Ze=Ce,R=r(75427),q=r(80590),w=R.Z.Option,Fe=q.Z.TreeNode,Ie=function(n){var t=n.initialValues,i=n.hostGroups,v=n.machineProxies,y=n.serverKeys,N=n.onSubmit,L=n.onCancel,U=n.onUpdate,k=u.Z.useForm(),j=g()(k,1),E=j[0],$=(0,h.useState)(1),P=g()($,2),F=P[0],D=P[1];(0,h.useEffect)(function(){t&&(E.setFieldsValue(t),D(t.authType))},[t,E]);var G=function l(f){return f==null?void 0:f.map(function(c){return(0,e.jsx)(Fe,{value:c.hostGroupId,title:c.name,children:c.children&&c.children.length>0?l(c.children):null},c.hostGroupId)})};return(0,e.jsxs)(u.Z,{form:E,layout:"vertical",children:[(0,e.jsx)(u.Z.Item,{name:"name",label:"\u5B9E\u4F8B\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5B9E\u4F8B\u540D\u79F0"}],children:(0,e.jsx)(I.Z,{})}),(0,e.jsx)(u.Z.Item,{name:"hostName",label:"\u4E3B\u673A\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3B\u673A\u540D\u79F0"}],children:(0,e.jsx)(I.Z,{})}),(0,e.jsx)(u.Z.Item,{name:"hostGroupIds",label:"\u673A\u5668\u7EC4",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u673A\u5668\u7EC4"}],children:(0,e.jsx)(q.Z,{showSearch:!0,style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"\u8BF7\u9009\u62E9\u673A\u5668\u7EC4",allowClear:!0,multiple:!0,treeDefaultExpandAll:!0,showCheckedStrategy:q.Z.SHOW_ALL,treeCheckStrictly:!0,treeNodeFilterProp:"hostGroupId",children:G(i)})}),(0,e.jsx)(u.Z.Item,{name:"serverAddr",label:"\u670D\u52A1\u5730\u5740",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u670D\u52A1\u5730\u5740"}],children:(0,e.jsx)(I.Z,{})}),(0,e.jsx)(u.Z.Item,{name:"port",label:"\u7AEF\u53E3",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7AEF\u53E3"}],children:(0,e.jsx)(I.Z,{type:"number"})}),(0,e.jsx)(u.Z.Item,{label:"\u673A\u5668\u4EE3\u7406",name:"proxyId",children:(0,e.jsx)(R.Z,{placeholder:"\u8BF7\u9009\u62E9\u673A\u5668\u4EE3\u7406",children:v.map(function(l){return(0,e.jsx)(w,{value:l.id,children:l.proxyHost+"\u3010"+l.proxyUsername+"\u3011"},l.id)})})}),(0,e.jsx)(u.Z.Item,{name:"username",label:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}],children:(0,e.jsx)(I.Z,{})}),(0,e.jsx)(u.Z.Item,{label:"\u8BA4\u8BC1\u6A21\u5F0F",name:"authType",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BA4\u8BC1\u6A21\u5F0F"}],children:(0,e.jsxs)(R.Z,{placeholder:"\u8BF7\u9009\u62E9\u8BA4\u8BC1\u6A21\u5F0F",onChange:function(f){return D(f)},defaultValue:1,children:[(0,e.jsx)(w,{value:1,children:"\u8D26\u53F7\u5BC6\u7801\u8BA4\u8BC1"}),(0,e.jsx)(w,{value:2,children:"\u79C1\u94A5\u8BA4\u8BC1"})]})}),F===1&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(u.Z.Item,{name:"pwd",label:"\u5BC6\u7801",children:(0,e.jsx)(I.Z.Password,{})})}),F===2&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(u.Z.Item,{name:"keyId",label:"\u79C1\u94A5",children:(0,e.jsx)(R.Z,{placeholder:"\u8BF7\u9009\u62E9\u79C1\u94A5",children:y.map(function(l){return(0,e.jsx)(w,{value:l.id,children:l.displayName+"\u3010"+l.protocol+"\u3011"},l.id)})})})}),(0,e.jsxs)(u.Z.Item,{children:[(0,e.jsx)(z.Z,{type:"primary",onClick:function(){E.validateFields().then(function(f){var c=f.hostGroupIds.map(function(A){return A.value}),K=H()(H()({},f),{},{hostGroupIds:c});t?U(K):(console.log("submit",K),N(K)),E.resetFields()})},children:t?"\u4FDD\u5B58":"\u63D0\u4EA4"}),(0,e.jsx)(z.Z,{onClick:L,style:{marginLeft:8},children:"\u53D6\u6D88"})]})]})},Ee=Ie,Ge=r(77695),Ae=ce.Z.confirm,Be=function(n){var t=n.dispatch,i=n.hosts,v=n.hostGroups,y=n.total,N=n.machineProxies,L=n.serverKeys,U=(0,h.useState)(null),k=g()(U,2),j=k[0],E=k[1],$=(0,h.useState)({pageNo:1,pageSize:10}),P=g()($,2),F=P[0],D=P[1],G=(0,h.useState)(!1),l=g()(G,2),f=l[0],c=l[1],K=(0,h.useState)({name:"",hostName:""}),A=g()(K,2),p=A[0],S=A[1],B=(0,h.useState)(void 0),m=g()(B,2),C=m[0],O=m[1],_=function(){t({type:"host/fetchHosts",payload:H()(H()({},F),p)})},W=function(a){O(a),c(!0)},He=function(a){Ae({title:"\u786E\u8BA4\u5220\u9664",icon:(0,e.jsx)(Ge.Z,{}),content:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u4E3B\u673A\u5417\uFF1F",okText:"\u786E\u8BA4",okType:"danger",cancelText:"\u53D6\u6D88",onOk:function(){t({type:"host/deleteHost",payload:{hostId:a},callback:function(){X.ZP.success("\u5220\u9664\u6210\u529F")}})},onCancel:function(){}})},Pe=function(a){t({type:"host/pingHost",payload:{hostId:a},callback:function(){X.ZP.success("Ping \u64CD\u4F5C\u6210\u529F")}})},De=function(a){t({type:"host/copyHost",payload:{hostId:a},callback:function(){X.ZP.success("\u5220\u9664\u6210\u529F")}})},se=function(){O(void 0),c(!1),b.resetFields()},Ne=u.Z.useForm(),ke=g()(Ne,1),b=ke[0];(0,h.useEffect)(function(){Ke();var s=[];j&&(console.log("select group",j),s=Ue(j),console.log("choose group",s)),t({type:"host/fetchHosts",payload:H()(H()({},F),{},{hostGroupsIds:s,name:p.name,hostName:p.hostName})})},[F,j,t]);var Ke=function(){t({type:"host/fetchHostGroups",payload:{}})},Le=function(){t({type:"proxy/queryProxies",payload:{}})},Oe=function(){t({type:"host/queryServerKeys",payload:{}})};(0,h.useEffect)(function(){Le(),Oe()},[]);var Ve=function(a){E(a)},ze=function(a){var o=[],d=function Z(T){o.push(T),T.children&&T.children.forEach(Z)};return a.forEach(d),o},Ue=function(a){var o=ze(v),d=function(Q){return o.find(function(V){return V.hostGroupId===Q})},Z=[],T=function J(Q){var V=d(Q);V&&(Z.push(Q),V.children&&V.children.length>0&&V.children.forEach(function(Je){J(Je.hostGroupId)}))};return T(a),Z},$e=function(a,o){D({pageNo:a,pageSize:o||10})},be=function(a){S(a),D({pageNo:1,pageSize:10})},Me=function(){c(!f)},Re=function(){var s=te()(M()().mark(function a(o){return M()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:console.log("\u521B\u5EFA\u4E3B\u673A:",o),t({type:"host/createHost",payload:o}),c(!1),b.resetFields();case 4:case"end":return Z.stop()}},a)}));return function(o){return s.apply(this,arguments)}}(),we=function(){var s=te()(M()().mark(function a(o){var d;return M()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:try{d=C==null?void 0:C.hostId,t({type:"/host/updateHost",payload:H()(H()({},o),{},{hostId:d})}),_(),c(!1),b.resetFields()}catch(J){console.error("\u66F4\u65B0\u4E3B\u673A\u5931\u8D25:",J)}case 1:case"end":return T.stop()}},a)}));return function(o){return s.apply(this,arguments)}}(),We=[{title:"\u5B9E\u4F8B\u540D\u79F0",dataIndex:"name",key:"name"},{title:"\u4E3B\u673A\u540D\u79F0",dataIndex:"hostName",key:"hostName"},{title:"\u670D\u52A1\u5730\u5740",dataIndex:"serverAddr",key:"serverAddr"},{title:"\u7AEF\u53E3",dataIndex:"port",key:"port"},{title:"\u8BA4\u8BC1\u6A21\u5F0F",dataIndex:"authType",key:"authType",render:function(a,o){var d=o.authType===1?"\u57FA\u7840\u6A21\u5F0F":"\u79D8\u94A5\u6A21\u5F0F";return(0,e.jsx)(ne.Z,{color:"success",children:d})}},{title:"\u72B6\u6001",dataIndex:"status",key:"status",render:function(a,o){var d=o.status==="0"?"success":"error",Z=o.status==="0"?"\u6B63\u5E38":"\u505C\u7528";return(0,e.jsx)(ne.Z,{color:d,children:Z})}},{title:"\u64CD\u4F5C",key:"action",render:function(a,o){return(0,e.jsxs)(Y.Z,{size:"middle",children:[(0,e.jsx)("a",{type:"link",onClick:function(){return Pe(o.hostId)},children:"Ping"}),(0,e.jsx)("a",{type:"link",onClick:function(){return De(o.hostId)},children:"\u590D\u5236"}),(0,e.jsx)("a",{onClick:function(){return W(o)},children:"\u7F16\u8F91"}),(0,e.jsx)("a",{onClick:function(){return He(o.hostId)},children:"\u5220\u9664"})]})}}];return(0,e.jsx)(pe._z,{title:"\u4E3B\u673A\u7BA1\u7406",children:(0,e.jsxs)(de.Z,{gutter:16,children:[(0,e.jsx)(re.Z,{span:4,children:(0,e.jsx)(Ze,{data:v,onGroupSelect:Ve})}),(0,e.jsx)(re.Z,{span:20,children:(0,e.jsx)(he.Z,{children:(0,e.jsxs)(Y.Z,{size:"middle",direction:"vertical",style:{width:"100%"},children:[(0,e.jsxs)(u.Z,{form:b,layout:"inline",onFinish:function(a){console.log(a),S(a),be(a)},children:[(0,e.jsx)(u.Z.Item,{name:"name",label:"\u5B9E\u4F8B\u540D\u79F0",children:(0,e.jsx)(I.Z,{placeholder:"\u8BF7\u8F93\u5165\u5B9E\u4F8B\u540D\u79F0"})}),(0,e.jsx)(u.Z.Item,{name:"hostName",label:"\u4E3B\u673A\u540D\u79F0",children:(0,e.jsx)(I.Z,{placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673A\u540D\u79F0"})}),(0,e.jsxs)(u.Z.Item,{children:[(0,e.jsx)(z.Z,{type:"primary",htmlType:"submit",style:{marginRight:8},children:"\u67E5\u8BE2"}),(0,e.jsx)(z.Z,{onClick:function(){b.resetFields(),S({name:"",hostName:""})},children:"\u91CD\u7F6E"})]})]}),(0,e.jsx)(z.Z,{type:"primary",onClick:Me,children:"\u65B0\u589E\u4E3B\u673A"}),(0,e.jsx)(ve.Z,{title:C?"\u7F16\u8F91\u4E3B\u673A":"\u65B0\u589E\u4E3B\u673A",width:400,open:f,onClose:se,destroyOnClose:!0,children:(0,e.jsx)(Ee,{initialValues:C,hostGroups:v,machineProxies:N,serverKeys:L,onSubmit:Re,onUpdate:we,onCancel:se})}),(0,e.jsx)(fe.Z,{columns:We,dataSource:i,rowKey:"hostId",pagination:{total:y,current:F.pageNo,pageSize:F.pageSize,onChange:$e}})]})})})]})})},Te=(0,me.connect)(function(x){var n=x.host,t=x.proxy;return{hosts:n.hosts,hostGroups:n.hostGroups,total:n.total,machineProxies:t.proxies,serverKeys:n.serverKeys}})(Be)}}]);
