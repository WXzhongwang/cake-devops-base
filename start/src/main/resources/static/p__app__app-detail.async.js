"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[105],{6479:function(ge,z,r){r.r(z),r.d(z,{default:function(){return Ze}});var k=r(77117),b=r.n(k),q=r(28152),F=r.n(q),g=r(93236),_=r(25556),M=r(75427),u=r(67801),V=r(93034),H=r(95020),C=r(53330),n=r(91753),ee=r(36222),re=r(53970),U=r(30301),L=r(51593),te=r(13448),K=r.n(te),le=r(74815),ue=r.n(le),G=r(56425),Y=r(31756),ne=r(69416),ae=r(48491),e=r(62086),N=M.Z.Option,se=function(l){var p=l.open,d=l.onClose,t=l.onFinish,E=l.clusterList,S=u.Z.useForm(),R=F()(S,1),v=R[0];return(0,e.jsx)(G.Z,{title:"\u6DFB\u52A0\u73AF\u5883",width:500,onClose:d,open:p,bodyStyle:{paddingBottom:80},children:(0,e.jsxs)(u.Z,{layout:"vertical",form:v,initialValues:{needApproval:!1,autoScaling:!1},onFinish:t,children:[(0,e.jsx)(u.Z.Item,{name:"envName",label:"\u73AF\u5883\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u73AF\u5883\u540D\u79F0"}],children:(0,e.jsx)(Y.Z,{placeholder:"\u8BF7\u8F93\u5165\u73AF\u5883\u540D\u79F0"})}),(0,e.jsx)(u.Z.Item,{name:"env",label:"\u73AF\u5883\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883\u7C7B\u578B"}],children:(0,e.jsxs)(M.Z,{placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883\u7C7B\u578B",children:[(0,e.jsx)(N,{value:"TEST",children:"\u6D4B\u8BD5"}),(0,e.jsx)(N,{value:"PRE",children:"\u9884\u53D1"}),(0,e.jsx)(N,{value:"PROD",children:"\u7EBF\u4E0A"})]})}),(0,e.jsx)(u.Z.Item,{name:"clusterId",label:"\u9009\u62E9\u96C6\u7FA4",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u96C6\u7FA4"}],children:(0,e.jsx)(M.Z,{placeholder:"\u8BF7\u9009\u62E9\u96C6\u7FA4",children:E&&E.map(function(o){return(0,e.jsxs)(N,{value:o.clusterId,children:[o.clusterName,"(",o.clusterType,")"]},o.clusterId)})})}),(0,e.jsx)(u.Z.List,{name:"domains",rules:[{validator:function(){var o=ue()(K()().mark(function x(B,h){return K()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(h&&h.length>3)){c.next=2;break}return c.abrupt("return",Promise.reject(new Error("\u6700\u591A\u914D\u7F6E3\u4E2A\u57DF\u540D")));case 2:case"end":return c.stop()}},x)}));function Z(x,B){return o.apply(this,arguments)}return Z}()}],children:function(Z,x,B){var h=x.add,I=x.remove,c=B.errors;return(0,e.jsxs)(e.Fragment,{children:[Z.map(function(f,D){return(0,e.jsxs)(u.Z.Item,{style:{width:"100%"},label:D===0?"\u57DF\u540D":"",required:!1,children:[(0,e.jsx)(u.Z.Item,b()(b()({},f),{},{validateTrigger:["onChange","onBlur"],rules:[{required:!0,whitespace:!0,message:"\u8BF7\u8F93\u5165\u5408\u6CD5\u7684\u57DF\u540D"}],noStyle:!0,children:(0,e.jsx)(Y.Z,{style:{width:260},placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D"})})),(0,e.jsx)(ne.Z,{style:{margin:"0 8px"},className:"dynamic-delete-button",onClick:function(){return I(f.name)}})]},f.key)}),(0,e.jsxs)(u.Z.Item,{children:[(0,e.jsx)(C.Z,{type:"dashed",onClick:function(){return h()},style:{width:"60%"},icon:(0,e.jsx)(ae.Z,{}),children:"\u589E\u52A0\u57DF\u540D"}),(0,e.jsx)(u.Z.ErrorList,{errors:c})]})]})}}),(0,e.jsx)(u.Z.Item,{name:"replicas",label:"\u526F\u672C\u6570",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u526F\u672C\u6570"}],children:(0,e.jsx)(Y.Z,{type:"number",placeholder:"\u8BF7\u8F93\u5165\u526F\u672C\u6570"})}),(0,e.jsx)(u.Z.Item,{children:(0,e.jsx)(C.Z,{type:"primary",htmlType:"submit",children:"\u63D0\u4EA4"})})]})})},ie=se,oe=r(62812),de=r.n(oe),ce=r(34226),W=r(98984),me=r(23817),pe=r(69931),he=r(40351),ve=r(60342),A=M.Z.Option,xe=function(l){switch(l){case"OWNER":return"\u62E5\u6709\u8005";case"DEVELOPER":return"\u5F00\u53D1";case"TESTER":return"\u6D4B\u8BD5";case"OPERATOR":return"\u8FD0\u7EF4";case"ARCHITECT":return"\u67B6\u6784\u5E08";case"REPORTER":return"\u544A\u8B66\u63A5\u6536";case"CHECKER":return"\u90E8\u7F72\u5BA1\u6279";default:return l}},je=function(l){var p=l.dispatch,d=l.onClose,t=l.open,E=l.appMembers,S=(0,g.useState)(!1),R=F()(S,2),v=R[0],o=R[1];console.log("appMembers",E);var Z=[{title:"\u4EBA\u5458\u540D\u79F0",dataIndex:"name",render:function(s,i){return i.accountDTO.accountName}},{title:"\u4EBA\u5458\u89D2\u8272",dataIndex:"roles",key:"roles",render:function(s){return(0,e.jsx)(e.Fragment,{children:s.map(function(i){return(0,e.jsx)(U.Z,{children:xe(i)},i)})})}},{title:"\u64CD\u4F5C",key:"action",width:100,render:function(s,i){return(0,e.jsxs)(V.Z,{size:"middle",children:[(0,e.jsx)(C.Z,{type:"link",icon:(0,e.jsx)(he.Z,{}),onClick:function(){return O(i)}}),(0,e.jsx)(ce.Z,{title:"\u786E\u5B9A\u5220\u9664\u8BE5\u4EBA\u5458\u5417\uFF1F",onConfirm:function(){return $(i)},okText:"\u662F",cancelText:"\u5426",children:(0,e.jsx)(C.Z,{type:"link",icon:(0,e.jsx)(ve.Z,{})})})]})}}],x=(0,g.useState)(null),B=F()(x,2),h=B[0],I=B[1],c=u.Z.useForm(),f=F()(c,1),D=f[0],T=function(s){I(s),o(!0),D.setFieldsValue({roles:s.roles})},O=function(s){T(s)},$=function(s){console.log("\u5220\u9664\u4EBA\u5458\uFF1A".concat(s.name)),p({type:"app/deleteMember",payload:{memberId:s==null?void 0:s.memberId}}),d(),W.ZP.success("\u5220\u9664\u9879\u76EE\u6210\u5458\u6210\u529F")},w=function(s){try{D.validateFields().then(function(i){p({type:"app/updateMember",payload:b()(b()({},i),{},{memberId:h==null?void 0:h.memberId})}),console.log("\u66F4\u65B0\u89D2\u8272\u4E3A\uFF1A".concat(i.roles)),o(!1),D.resetFields(),d(),W.ZP.success("\u66F4\u65B0\u6210\u529F")})}catch(i){console.log("\u66F4\u65B0\u5931\u8D25:",i)}};return(0,e.jsxs)(G.Z,{title:"\u9879\u76EE\u6210\u5458",width:600,onClose:d,open:t,bodyStyle:{paddingBottom:80},children:[(0,e.jsx)(me.Z,{dataSource:E.list,columns:Z,rowKey:"memberId",pagination:!1}),(0,e.jsx)(pe.Z,{title:"\u7F16\u8F91\u89D2\u8272",open:v,onCancel:function(){return o(!1)},onOk:w,children:(0,e.jsx)(u.Z,{form:D,layout:"vertical",children:(0,e.jsx)(u.Z.Item,{label:"\u4EBA\u5458\u89D2\u8272",name:"roles",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4EBA\u5458\u89D2\u8272"}],children:(0,e.jsxs)(M.Z,{style:{width:"100%"},mode:"multiple",children:[(0,e.jsx)(A,{value:"OWNER",children:"\u62E5\u6709\u8005"}),(0,e.jsx)(A,{value:"DEVELOPER",children:"\u5F00\u53D1"}),(0,e.jsx)(A,{value:"TESTER",children:"\u6D4B\u8BD5"}),(0,e.jsx)(A,{value:"OPERATOR",children:"\u8FD0\u7EF4"}),(0,e.jsx)(A,{value:"ARCHITECT",children:"\u67B6\u6784\u5E08"}),(0,e.jsx)(A,{value:"REPORTER",children:"\u544A\u8B66\u63A5\u6536"}),(0,e.jsx)(A,{value:"CHECKER",children:"\u90E8\u7F72\u5BA1\u6279"})]})})})})]})},Fe=(0,L.connect)(function(y){return de()(y),{}})(je),ye=r(5726),J=r.n(ye),Q=_.Z.Paragraph,Ce=M.Z.Option,Ee=function(l){var p,d=l.dispatch,t=l.appDetail,E=l.clusterList,S=l.appMembers,R=(0,L.useParams)(),v=R.id,o=(0,g.useState)({pageNo:1,pageSize:10}),Z=F()(o,2),x=Z[0],B=Z[1],h=(0,g.useState)(!1),I=F()(h,2),c=I[0],f=I[1],D=(0,g.useState)(!1),T=F()(D,2),O=T[0],$=T[1],w=u.Z.useForm(),j=F()(w,1),s=j[0];(0,g.useEffect)(function(){d({type:"app/getAppDetail",payload:{id:v}})},[d,v]),(0,g.useEffect)(function(){i(),d({type:"cluster/listAll"})},[d,O]);var i=function(){d({type:"app/pageAppMembers",payload:b()(b()({},x),{},{appId:v})})},P=function(){f(!c)},X=function(){$(!O)},fe=function(m){console.log("Received values:",m),d({type:"app/createAppEnv",payload:{appId:v,env:{env:m.env,clusterId:m.clusterId,envName:m.envName,needApproval:m.needApproval,autoScaling:m.autoScaling,domains:m.domains,resourceStrategy:{replicas:m.replicas,cpu:m.cpu,memory:m.memory,maxCpu:m.maxCpu,maxMemory:m.maxCpu}}}}),P()},De=function(){L.history.push("/app/deploy/".concat(v))};return console.log("clusters",E),(0,e.jsxs)(V.Z,{style:{width:"100%"},direction:"vertical",size:"large",children:[(0,e.jsxs)(H.Z,{title:"".concat(t==null?void 0:t.appName," \u8BE6\u60C5\u9875"),extra:(0,e.jsxs)("div",{children:[(0,e.jsx)(C.Z,{onClick:De,children:"\u7ACB\u5373\u90E8\u7F72"}),(0,e.jsx)(C.Z,{onClick:X,style:{marginLeft:16},children:"\u9879\u76EE\u6210\u5458"})]}),children:[(0,e.jsx)(V.Z,{style:{width:"100%"},direction:"vertical",size:"large",children:(0,e.jsxs)(n.Z,{title:"\u5E94\u7528\u57FA\u7840\u8BE6\u60C5",bordered:!0,children:[(0,e.jsx)(n.Z.Item,{label:"\u5E94\u7528\u540D\u79F0",children:(0,e.jsx)(Q,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F"]},style:{display:"inline"},children:(p=t==null?void 0:t.appName)!==null&&p!==void 0?p:"--"})}),(0,e.jsx)(n.Z.Item,{label:"\u4ED3\u5E93",children:(0,e.jsx)(Q,{copyable:{tooltips:["\u70B9\u51FB\u590D\u5236","\u590D\u5236\u6210\u529F"]},style:{display:"inline"},children:t==null?void 0:t.repo})}),(0,e.jsx)(n.Z.Item,{label:"\u8BED\u8A00",children:t==null?void 0:t.language}),(0,e.jsx)(n.Z.Item,{label:"\u9ED8\u8BA4\u5206\u652F",children:t==null?void 0:t.defaultBranch}),(0,e.jsx)(n.Z.Item,{label:"\u5F00\u53D1\u6A21\u5F0F",children:t==null?void 0:t.developMode}),(0,e.jsx)(n.Z.Item,{label:"\u90E8\u95E8",children:t==null?void 0:t.department}),(0,e.jsx)(n.Z.Item,{label:"\u90E8\u95E8\u7F29\u5199",children:t==null?void 0:t.departmentAbbreviation}),(0,e.jsx)(n.Z.Item,{label:"\u521B\u5EFA\u65F6\u95F4",children:J()(t==null?void 0:t.gmtCreate).format("YYYY-MM-DD HH:mm:ss")}),(0,e.jsx)(n.Z.Item,{label:"\u66F4\u65B0\u65F6\u95F4",children:J()(t==null?void 0:t.gmtModified).format("YYYY-MM-DD HH:mm:ss")})]})}),(0,e.jsx)(ie,{onClose:P,onFinish:fe,open:c,clusterList:E}),(0,e.jsx)(Fe,{appMembers:S,onClose:X,open:O})]}),(0,e.jsx)(H.Z,{title:"\u73AF\u5883\u4FE1\u606F",extra:(0,e.jsx)("div",{children:(0,e.jsx)(C.Z,{onClick:P,children:"\u6DFB\u52A0\u73AF\u5883"})}),children:(0,e.jsx)(ee.Z,{justify:"start",children:t==null?void 0:t.appEnvList.map(function(a){return(0,e.jsx)(re.Z,{span:8,children:(0,e.jsxs)(H.Z,{title:a.envName,extra:(0,e.jsx)("a",{href:"#",children:"\u8BE6\u60C5"}),style:{width:300,marginBottom:"16px"},children:[(0,e.jsxs)("p",{children:["\u73AF\u5883: ",a.env]}),(0,e.jsxs)("p",{children:["\u73AF\u5883\u72B6\u6001:"," ",(0,e.jsx)(U.Z,{color:a.status==="1"?"success":"error",children:a.status==="1"?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"})]}),(0,e.jsxs)("div",{style:{marginTop:"16px"},children:[(0,e.jsx)("h5",{children:"\u8D44\u6E90\u7B56\u7565"}),(0,e.jsxs)(n.Z,{colon:!0,column:1,bordered:!0,size:"small",children:[(0,e.jsx)(n.Z.Item,{label:"\u526F\u672C\u6570",children:a.resourceStrategy.replicas}),(0,e.jsx)(n.Z.Item,{label:"CPU",children:a.resourceStrategy.cpu}),(0,e.jsx)(n.Z.Item,{label:"\u5185\u5B58",children:a.resourceStrategy.memory}),(0,e.jsx)(n.Z.Item,{label:"\u6700\u5927CPU",children:a.resourceStrategy.maxCpu}),(0,e.jsx)(n.Z.Item,{label:"\u6700\u5927\u5185\u5B58",children:a.resourceStrategy.maxMemory})]})]})]},a.envId)},a.envId)})})})]})},Ze=(0,L.connect)(function(y){var l=y.app,p=y.cluster;return{appDetail:l.appDetail,appMembers:l.appMembers,clusterList:p.clusterList}})(Ee)}}]);
